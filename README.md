# Oil derrik data calculate API
## Общее описание

API предоставляет функционал рассчёта данных по заданному алгоритму. Входные и выходные данные передаются в формате JSON. Реализована валидация входных и выходных данных и очередь расчётов, основанная на `celery`. 

Для ввода и вывода данных сделан один эндпоинт с анализом типа запроса.
```
https:/(hostname)/reports/report_info
```
## Формат входных данных
На вход принимается JSON вида
```json
 {
   "date_start": <str>, 
   "date_fin": <str>,
   "lag": <int>
 }
```
Пример:
```json
 {
   "date_start": "2020-12-12", 
   "date_fin": "2021-12-12",
   "lag": 50
 }
```

## Формат выходных данных

После добавления расчёта в очередь, на вывод будет передан JSON вида
```json
"root":{
"task_id": <str>
}
```
где в поле `task_id` будет записан идентификатор добавленной в очередь задачи.

Пример:
```json
"root":{
"task_id":"1bd92554-16fb-4249-b5a6-4cac69cc2fc1"
}
```
## Запрос списка всех задач

Для запроса списка созданных задач достаточно передать GET-запрос. Для списка задач реализована пагинация, поэтому после первого запроса будет передан JSON c первыми десятью записями, указанием наличия следующей и предыдущей страницы и общим количеством записей.

В информации о задачах выводится идентификатор задачи `task_id`, дата и время создания задачи `task_created` и текущий статус задачи `task_status`.

Пример:
```json
"root":{
    "count":152,
    "next":True,
    "previous":False,
    "results":[
        0:{
        "task_id":"ffca3a41-88f8-4e16-8c53-41ac58d83b87",
        "task_created":"2022-08-05 03:40:44.889599",
        "task_status":"FAILED"
        }
        1:{
        "task_id":"1bd92554-16fb-4249-b5a6-4cac69cc2fc1",
        "task_created":"2022-08-05 04:24:20.514276",
        "task_status":"SUCCESS",
        }
        2: {"(etc)"}
    ]
}
```
## Запрос результатов одного конкретного запуска расчёта
Чтобы запросить результаты конкретного расчёта, необходимо в GET запрос передать JSON с полем `task_id`. Пример:

```json
 {
  "task_id": "de8a0282-4337-47a8-80ec-557c3d8ccf4c"
 }
```

Если расчёт ещё не окончен, ответом будет JSON со строкой `None`. Если задача не найдена в списке всех задач, ответом будет JSON со строкой `Does not exist`.

Пример успешного ответа:
```json
"root":{
    "task_id":"de8a0282-4337-47a8-80ec-557c3d8ccf4c"
    "task_created":"2022-08-05 04:43:27.929572"
    "task_status":"SUCCESS"
    "date":"{0: Timestamp('2020-12-12 00:00:00'), 1: Timestamp('2021-01-31 00:00:00'), 2: Timestamp('2021-03-22 00:00:00'), 3: Timestamp('2021-05-11 00:00:00'), 4: Timestamp('2021-06-30 00:00:00'), 5: Timestamp('2021-08-19 00:00:00'), 6: Timestamp('2021-10-08 00:00:00'), 7: Timestamp('2021-11-27 00:00:00')}"
    "liquid":"{0: 76.9307903994469, 1: 77.72442460202006, 2: 85.08960602622098, 3: 82.36897738967971, 4: 69.35552147103247, 5: 69.75718437575127, 6: 68.61846253470543, 7: 69.59067572094291}"
    "oil":"{0: 72.23985868987488, 1: 63.63535145552629, 2: 53.56159017227086, 3: 46.01379678929555, 4: 40.04450726384624, 5: 32.11172750980334, 6: 23.31463735962849, 7: 17.46017947417211}"
    "water":"{0: 4.690931709572027, 1: 14.089073146493774, 2: 31.528015853950116, 3: 36.355180600384166, 4: 29.311014207186233, 5: 37.64545686594793, 6: 45.30382517507694, 7: 52.130496246770804}"
    "wct":"{0: 0.06097599784449573, 1: 0.1812695715489105, 2: 0.3705272280169511, 3: 0.4413698184984294, 4: 0.42261976531210255, 5: 0.5396642253100185, 6: 0.6602279255697903, 7: 0.7491017396614017}"
}
```
## Способ проверки работы сервиса через терминал Linux
Тестовая команда, добавляющая задачу по расчёту в очередь сервиса, запущенного на `localhost:8000`:
```bash
curl --header "Content-Type: application/json"   --request POST   --data '{"date_start": "2021-12-12","date_fin": "2022-12-12", "lag": "50"}'   http://localhost:8000/reports/report_info
```